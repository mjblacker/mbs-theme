{#
    Attribute Dropdown Component
    
    Generic dropdown for product attribute variations matching the design
    Can be used for any attribute by passing attribute_name and attribute_label
#}

{% set attribute_name = attribute_name|default('size') %}
{% set attribute_label = attribute_label|default('Size') %}

<div class="attr-dropdown" 
     x-data="sizeDropdown()" 
     data-sizes="{{ sizes|json_encode|e('html_attr') }}"
     data-attribute="{{ attribute_name }}">
    <label for="size-select" class="block text-sm font-medium text-gray-700 mb-2">
        {{ attribute_label }}
    </label>
    
    <div class="relative">
        <button type="button" 
                @click="toggleOpen()" 
                @click.away="closeDropdown()"
                :class="{ 'border-blue-500': isOpen }"
                class="w-full bg-white border border-gray-300 rounded px-4 py-3 text-left focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent flex items-center justify-between">
            <span class="block truncate" x-text="selectedSize ? selectedSize.name : 'Select {{ attribute_label }}'"></span>
            <svg class="w-5 h-5 text-gray-400 transition-transform duration-200" 
                 :class="{ 'rotate-180': isOpen }" 
                 fill="none" 
                 stroke="currentColor" 
                 viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
        </button>

        <!-- Dropdown Options -->
        <div x-show="isOpen" 
             x-transition:enter="transition ease-out duration-100"
             x-transition:enter-start="transform opacity-0 scale-95"
             x-transition:enter-end="transform opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-75"
             x-transition:leave-start="transform opacity-100 scale-100"
             x-transition:leave-end="transform opacity-0 scale-95"
             class="absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded border border-gray-300 py-1 text-base overflow-auto focus:outline-none"
             style="display: none;">
            
            <template x-for="option in sizeOptions" :key="option.value">
                <button type="button" 
                        @click="selectSize(option)" 
                        :class="{ 
                            'bg-blue-50 text-blue-600': selectedSize && selectedSize.value === option.value,
                            'text-gray-900 hover:bg-gray-50': !selectedSize || selectedSize.value !== option.value
                        }"
                        :disabled="!option.available"
                        class="w-full px-4 py-2 text-left disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-between">
                    <span x-text="option.name"></span>
                    <span x-show="!option.available" class="text-sm text-gray-400">(Out of Stock)</span>
                    <svg x-show="selectedSize && selectedSize.value === option.value" 
                         class="w-5 h-5 text-blue-600" 
                         fill="none" 
                         stroke="currentColor" 
                         viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </button>
            </template>
            
            <!-- No options message -->
            <div x-show="sizeOptions.length === 0" class="px-4 py-2 text-gray-500 text-sm">
                No size options available
            </div>
        </div>
    </div>
    
    <!-- Hidden input for form submission -->
    <input type="hidden" 
           name="attribute_{{ attribute_name }}" 
           :value="selectedSize ? selectedSize.value : ''" 
           x-ref="sizeInput">
</div>

<style>
/* Custom dropdown styles to match design */
.attr-dropdown .rotate-180 {
    transform: rotate(180deg);
}
</style>