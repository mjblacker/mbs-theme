{% extends "base.twig" %}

{% block content %}
    <div class="woocommerce-checkout mb-10">
        <!-- Breadcrumbs -->
        {% include 'woocommerce/breadcrumbs.twig' %}

        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 overflow-x-hidden">
            <!-- Check if WooCommerce checkout is available -->
            {% if function('WC') and function('WC').cart %}
                {% set wc_cart = function('WC').cart %}
                {% set wc_checkout = function('WC').checkout %}
                
                {# Calculate cart totals and shipping if needed #}
                {% do function('WC').cart.calculate_totals() %}
                {# Calculate shipping packages #}
                {% do function('WC').shipping.calculate_shipping(function('WC').cart.get_shipping_packages()) %}
                
                {{ function('do_action', 'woocommerce_before_checkout_form_table')|raw }}
                
                <!-- Main Checkout Layout -->
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 lg:gap-8" x-data="checkoutPage">
                    <!-- Checkout Content (Left Side) -->
                    <div class="lg:col-span-7">
                        {% include 'components/checkout/checkout-form.twig' with { 
                            wc_checkout: wc_checkout,
                            wc_cart: wc_cart 
                        } %}
                    </div>

                    <!-- Order Summary (Right Side) -->
                    <div class="lg:col-span-5 woocommerce-checkout-review-order">
                        {% include 'components/checkout/order-summary.twig' with { 
                            wc_cart: wc_cart,
                            wc_checkout: wc_checkout 
                        } %}
                    </div>
                </div>

                {{ function('do_action', 'woocommerce_after_checkout_form_table')|raw }}
                
            {% else %}
                <div class="text-center py-12">
                    <p class="text-gray-600 text-lg">WooCommerce is not available.</p>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}